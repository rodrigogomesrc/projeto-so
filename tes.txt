# include "processo.hpp"
#include <ctime>

string Processo::getTempo(){
	time_t tempo = time(0);
	tm local = * localtime(&tempo);
	string hora = to_string(local.tm_hour);
	string min = to_string(local.tm_min);
	string seg = to_string(local.tm_sec);
	return hora + ":" + min + ":" + seg;


}
void Processo::executar() {
	nasc = getTempo();
	cout << "Pai nasce em: " << nasc << endl;
	pid_t pid;

	sleep(14);
	std::cout << "Criando primeiro filho após 14 anos:  " << getTempo() << std::endl;
	pid = fork();

	if(pid < 0){ //se erro
		std::cout << "erro na criação de um novo processo" << std::endl;

	} else if(pid == 0){ //se filho #filho 1
		nasc = getTempo();
		sleep(12);
		std::cout << "Criando o primeiro neto: " << nasc << std::endl;
		pid = fork();

		if(pid < 0){ //se error
			std::cout << "erro na criação de um novo processo" << std::endl;

		} else if (pid == 0){ //se filho #neto1
			nasc = getTempo();
			sleep(12);
			std::cout << "Neto 1 morrendo aos 12 anos: nascimento: "<< nasc << " morte: " << getTempo() << std::endl;
			exit(0);

		} else { //se pai #filho1
					
			sleep(18);
			std::cout << "Filho 1 morrendo aos 30 anos:  nascimento: "<< nasc << " morte: " << getTempo()<< std::endl;
			exit(0);

		}

	} else { //processo pai #primeiro pai

		sleep(2);
		std::cout << "Criando o segundo filho após 16 anos : " << getTempo() << std::endl;
		pid = fork();

		if(pid < 0){ //se error

		} else if (pid == 0){ //se filho #filho2
			nasc = getTempo();
			sleep(14);
			std::cout << "Criando segundo neto: " << getTempo() << std::endl;


			if(pid < 0){ //se error
				std::cout << "erro na criação de um novo processo" << std::endl;

			} else if (pid == 0){ //se filho

				sleep(18);
				std::cout << "Neto 2 morrendo aos 18 anos" << std::endl;
				exit(0);

			} else { //se pai

				sleep(16);
				std::cout << "Filho 2 morrendo aos 30 anos" << std::endl;
				exit(0);
						
			}

		} else { //se pai 
			
			sleep(44);
			std::cout << "Pai morrendo após 60 anos" << std::endl;
			exit(0);
		}


	}
 }